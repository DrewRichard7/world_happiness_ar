---
title: "shiny_practice"
output: html_document
---

# Building a Shiny App - 4 Steps

1.  Add inputs (UI)
2.  Add outputs (UI/server)
3.  Update Layout (UI)
4.  Update Outputs (server)

```{r}
library(shiny)
library(tidyverse)
library(babynames)
library(plotly)
library(gapminder)
```

Creating interactive Shiny App - Practice from DataCamp

```{r}
ui <- fluidPage(
  titlePanel("What's in a name?"), 
  sidebarLayout(
    sidebarPanel(
      selectInput('sex', 'Select Sex', choices = c('F', 'M')),
      sliderInput('year', 'Select Year', min = 1900, max = 2010, value=1950)
    ),
    mainPanel(
      tabsetPanel(
        tabPanel('Table',
          DT::DTOutput('table_top_10_names')
        ),
        tabPanel('Bar Plot',
                 plotOutput('plot_top_10_names')
        )
      )
    )
  )
   
)

server <- function(input, output, session){
  top_10_names <- function(){
    babynames |> 
      filter(sex==input$sex) |> 
      filter(year == input$year) |> 
      slice_max(prop, n=10)
  }
  output$table_top_10_names <- DT::renderDT({
    top_10_names() |> 
      DT::datatable()
  })
  output$plot_top_10_names <- renderPlot({
    # Get top 10 names by sex and year
    top_10_names <- babynames %>% 
      filter(sex == input$sex) %>% 
    # MODIFY CODE BELOW: Filter for the selected year
      filter(year == input$year) %>% 
      slice_max(prop, n = 10)
    # Plot top 10 names by sex and year
      ggplot(top_10_names, aes(x = name, y = prop)) +
        geom_col(fill = "#00CC96")
  })
}

shinyApp(ui = ui, server = server)
```

```{r}
babynames_sub <- babynames |> 
  top_n(500, n)
```

```{r}
ui <- fluidPage(
  selectInput('name', 'Pick a Name', babynames_sub$name),
  plotly::plotlyOutput('plot_trendy_names'),
  shinythemes::themeSelector()
  # theme = shinythemes::shinytheme('superhero')
)

server <- function(input, output, session){
  # Function to plot trends in a name
  plot_trends <- function(){
     babynames %>% 
      filter(name == input$name) %>% 
      ggplot(aes(x = year, y = n)) +
      geom_col()
  }
  # CODE BELOW: Render a plotly output named 'plot_trendy_names'
  output$plot_trendy_names <- plotly::renderPlotly(
    plot_trends()
  )
  
  
}

shinyApp(ui=ui, server=server)
```

```{r}
ui <- fluidPage(
  sidebarLayout(
    sidebarPanel(
      selectInput('name', 'Select Name', babynames_sub$name)
    ),
    mainPanel(
      # MODIFY CODE BLOCK BELOW: Wrap in a tabsetPanel
      tabsetPanel(
        # MODIFY CODE BELOW: Wrap in a tabPanel providing an appropriate label
        tabPanel(
          'Plot',
          plotly::plotlyOutput('plot_trendy_names'),
        ),
        # MODIFY CODE BELOW: Wrap in a tabPanel providing an appropriate label
        tabPanel(
          'Table',
          DT::DTOutput('table_trendy_names')
        )
      )
    )
  )
)

server <- function(input, output, session){
  # Function to plot trends in a name
  plot_trends <- function(){
     babynames %>% 
      filter(name == input$name) %>% 
      ggplot(aes(x = year, y = n)) +
      geom_col()
  }
  output$plot_trendy_names <- plotly::renderPlotly({
    plot_trends()
  })
  
  output$table_trendy_names <- DT::renderDT({
    babynames %>% 
      filter(name == input$name)
  })
}

shinyApp(ui = ui, server = server) 
```

## Gapminder App - Practice from DataCamp

```{r}
ui <- fluidPage(
  titlePanel('Life Expectancy vs. GDP Per Capita'),
  sidebarLayout(
    sidebarPanel(
      selectInput('continent', 'Select Continent', unique(gapminder$continent)),
      sliderInput('year', 'Select Year', 1952, 2007, 1992, step = 5)
    ),
    mainPanel(
      tabsetPanel(
        tabPanel('Plot', plotOutput('plot')),
        tabPanel('Table', DT::DTOutput('table'))
      )
    )
  )
)

server <- function(input, output, session){
  output$plot <- renderPlot({
    data<- gapminder |> 
      filter(year == input$year) |> 
      filter(continent == input$continent)
    print(data)
    ggplot(data, aes(x=gdpPercap, y=lifeExp)) + 
      geom_point()
  })
  output$table <- DT::renderDT({
    gapminder |> 
      filter(year==input$year) |> 
      filter(continent==input$continent)
  })
}

shinyApp(ui = ui, server = server) 

```

```{r}
ui <- fluidPage(
  
)

server <- function(input, output, session){
  
}

shinyApp(ui=ui, server=server)
```

## Greeting App

```{r}
ui <- fluidPage(
  selectInput('greeting_type', 'Select greeting', c('Hello', 'Bonjour')),
  textInput('name', 'Enter your name'),
  textOutput('greeting')
)

server <- function(input, output, session) {
  output$greeting <- renderText(paste(input$greeting_type, input$name))
}

shinyApp(ui = ui, server = server)
```

## Using Reactive Epressions

*my height is 1.78 m (5' 10") and weight is 74.8 kg (165 lbs)*

```{r}
ui <- fluidPage(
  titlePanel('BMI Calculator'),
  sidebarLayout(
    sidebarPanel(
      numericInput('height', 'Enter your height in meters', 1.5, 1, 2),
      numericInput('weight', 'Enter your weight in Kilograms', 60, 45, 120)
    ),
    mainPanel(
      textOutput("bmi"),
      textOutput("bmi_range")
    )
  )
)

server <- function(input, output, session) {
  # reactive expression rval_bmi to calculate BMI
  rval_bmi <- reactive({
    input$weight/(input$height^2)
  })
  output$bmi <- renderText({
    bmi <- rval_bmi()
    paste("Your BMI is", round(bmi, 1))
  })
  output$bmi_range <- renderText({
    bmi <- rval_bmi()
    bmi_status <- cut(bmi, 
      breaks = c(0, 18.5, 24.9, 29.9, 40),
      labels = c('underweight', 'healthy', 'overweight', 'obese')
    )
    paste("You are", bmi_status)
  })
}

shinyApp(ui = ui, server = server)
```

## Observers, Reactors

```{r}
ui <- fluidPage(
  titlePanel('BMI Calculator'),
  sidebarLayout(
    sidebarPanel(
      textInput('name', 'Enter your name'),
      numericInput('height', 'Enter height (in m)', 1.5, 1, 2, step = 0.1),
      numericInput('weight', 'Enter weight (in Kg)', 60, 45, 120),
      actionButton("show_bmi", "Show BMI")
    ),
    mainPanel(
      textOutput("bmi")
    )
  )
)

server <- function(input, output, session) {
  # MODIFY CODE BELOW: Use eventReactive to delay the execution of the
  # calculation until the user clicks on the show_bmi button (Show BMI)
  rval_bmi <- eventReactive(input$show_bmi, {
    input$weight/(input$height^2)
  })
  output$bmi <- renderText({
    bmi <- rval_bmi()
    paste("Hi", input$name, ". Your BMI is", round(bmi, 1))
  })
}

shinyApp(ui = ui, server = server)
```

## Action button, observeEvent, modalDialog

```{r}
bmi_help_text <- {"Body Mass Index is a simple calculation using a person's height and weight. The formula is BMI = kg/m2 where kg is a person's weight in kilograms and m2 is their height in metres squared. A BMI of 25.0 or more is overweight, while the healthy range is 18.5 to 24.9."}

ui <- fluidPage(
  titlePanel('BMI Calculator'),
  sidebarLayout(
    sidebarPanel(
      textInput('name', 'Enter your name'),
      numericInput('height', 'Enter your height in meters', 1.5, 1, 2),
      numericInput('weight', 'Enter your weight in Kilograms', 60, 45, 120),
      actionButton("show_bmi", "Show BMI"),
      # CODE BELOW: Add an action button named "show_help"
      actionButton('show_help', 'Help')
    ),
    mainPanel(
      textOutput("bmi")
    )
  )
)

server <- function(input, output, session) {
  # MODIFY CODE BELOW: Wrap in observeEvent() so the help text 
  # is displayed when a user clicks on the Help button.
  observeEvent(input$show_help,{
     # Display a modal dialog with bmi_help_text
     # MODIFY CODE BELOW: Uncomment code
     showModal(modalDialog(bmi_help_text))
  })
  rv_bmi <- eventReactive(input$show_bmi, {
    input$weight/(input$height^2)
  })
  output$bmi <- renderText({
    bmi <- rv_bmi()
    paste("Hi", input$name, ". Your BMI is", round(bmi, 1))
  })
}

shinyApp(ui = ui, server = server)
```

## Convert in to cm

```{r}
ui <- fluidPage(
  titlePanel("Inches to Centimeters Conversion"),
  sidebarLayout(
    sidebarPanel(
      numericInput("height", "Height (in)", 60),
      actionButton("show_height_cm", "Show height in cm")
    ),
    mainPanel(
      textOutput("height_cm")
    )
  )
)

server <- function(input, output, session) {
  # MODIFY CODE BELOW: Delay the height calculation until
  # the show button is pressed
  rval_height_cm <- eventReactive(input$show_height_cm, {
    input$height * 2.54
  })
  
  output$height_cm <- renderText({
    height_cm <- rval_height_cm()
    	paste("Your height in centimeters is", height_cm, "cm")
    })
}

shinyApp(ui = ui, server = server)
```

## Using data from NUFORC (unavailable for download at this time)

*this is what code would be used to create a dashboard*

```{r}
ui <- fluidPage(
  titlePanel("UFO Sightings"),
  sidebarLayout(
    sidebarPanel(
      selectInput("state", "Choose a U.S. state:", choices = unique(usa_ufo_sightings$state)),
      dateRangeInput("dates", "Choose a date range:",
                     start = "1920-01-01",
                     end = "1950-01-01")
    ),
    mainPanel(
    tabsetPanel(
      tabPanel('Plot', plotOutput("shapes")),
      tabPanel('Table', tableOutput("duration_table"))
    )
  )
  )
)

server <- function(input, output) {
  # CODE BELOW: Create a plot output of sightings by shape,
  # For the selected inputs
  output$shapes <- renderPlot({
    usa_ufo_sightings %>%
      filter(state == input$state,
          date_sighted >= input$dates[1],
          date_sighted <= input$dates[2]) %>%
      ggplot(aes(x=shape))+
      geom_bar()+
      labs(x = "Shape", y = "# Sighted")
      
  })
  
  
  
  # CODE BELOW: Create a table output named 'duration_table', by shape,
  # of # sighted, plus mean, median, max, and min duration of sightings
  # for the selected inputs
output$duration_table <- renderTable({
  usa_ufo_sightings%>%
    filter(
        state == input$state,
        date_sighted >= input$dates[1],
        date_sighted <= input$dates[2]
      ) %>%
      group_by(shape) %>%
      summarize(
        nb_sighted = n(),
        avg_duration = mean(duration_sec),
        median_duration = median(duration_sec),
        min_duration = min(duration_sec),
        max_duration = max(duration_sec)
      )
})
  
  
}

shinyApp(ui, server)
```

**Run in console to open Shiny Widgets Gallery** *shinyWidgets::shinyWidgetsGallery()*

## 2014 Mental Health in Tech Survey

*needs data from survey*

```{r}
ui <- fluidPage(
  titlePanel("2014 Mental Health in Tech Survey"),
  sidebarPanel(
    sliderTextInput(
      inputId = "work_interfere",
      label = "If you have a mental health condition, do you feel that it interferes with your work?", 
      grid = TRUE,
      force_edges = TRUE,
      choices = c("Never", "Rarely", "Sometimes", "Often")
    ),
    checkboxGroupInput(
      inputId = "mental_health_consequence",
      label = "Do you think that discussing a mental health issue with your employer would have negative consequences?", 
      choices = c("Maybe", "Yes", "No"),
      selected = "Maybe"
    ),
    pickerInput(
      inputId = "mental_vs_physical",
      label = "Do you feel that your employer takes mental health as seriously as physical health?", 
      choices = c("Don't Know", "No", "Yes"),
      multiple = TRUE
    )    
  ),
  mainPanel(
    plotOutput("age")  
  )
)

server <- function(input, output, session) {
  output$age <- renderPlot({
    # MODIFY CODE BELOW: Add validation that user selected a 3rd input
    validate(
      need(input$mental_vs_physical != '', 'Be sure to select an input for mental vs physical health')
    )
    
    
    
    
    

    mental_health_survey %>%
      filter(
        work_interfere == input$work_interfere,
        mental_health_consequence %in% input$mental_health_consequence,
        mental_vs_physical %in% input$mental_vs_physical
      ) %>%
      ggplot(aes(Age)) +
      geom_histogram()
  })
}

shinyApp(ui, server)
```
